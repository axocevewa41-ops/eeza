/* selectize.js - v0.12.1 | static/js/selectize.js | Apache License (v2) */
!function(c,d){"function"==typeof define&&define.amd?define("sifter",d):"object"==typeof exports?module.exports=d():c.Sifter=d()}(this,function(){var i=function(c,d){this.items=c,this.settings=d||{diacritics:!0}};i.prototype.tokenize=function(d){if(d=l(String(d||"").toLowerCase()),!d||!d.length){return[]}var e,g,q,r,s=[],t=d.split(/ +/);for(e=0,g=t.length;g>e;e++){if(q=m(t[e]),this.settings.diacritics){for(r in o){o.hasOwnProperty(r)&&(q=q.replace(new RegExp(r,"g"),o[r]))}}s.push({string:t[e],regex:new RegExp(q,"i")})}return s},i.prototype.iterator=function(d,e){var f;f=n(d)?Array.prototype.forEach||function(g){for(var h=0,q=this.length;q>h;h++){g(this[h],h,this)}}:function(c){for(var g in this){this.hasOwnProperty(g)&&c(this[g],g,this)}},f.apply(d,[e])},i.prototype.getScoreFunction=function(q,r){var s,t,u,v;s=this,q=s.prepareSearch(q,r),u=q.tokens,t=q.options.fields,v=u.length;var w=function(e,f){var g,h;return e?(e=String(e||""),h=e.search(f.regex),-1===h?0:(g=f.string.length/e.length,0===h&&(g+=0.5),g)):0},x=function(){var b=t.length;return b?1===b?function(c,d){return w(d[t[0]],c)}:function(a,d){for(var g=0,h=0;b>g;g++){h+=w(d[t[g]],a)}return h/b}:function(){return 0}}();return v?1===v?function(b){return x(u[0],b)}:"and"===q.options.conjunction?function(e){for(var f,g=0,h=0;v>g;g++){if(f=x(u[g],e),0>=f){return 0}h+=f}return h/v}:function(d){for(var e=0,f=0;v>e;e++){f+=x(u[e],d)}return f/v}:function(){return 0}},i.prototype.getSortFunction=function(b,q){var r,s,t,u,v,w,x,y,z,A,B;if(t=this,b=t.prepareSearch(b,q),B=!b.query&&q.sort_empty||q.sort,z=function(c,d){return"$score"===c?d.score:t.items[d.id][c]},v=[],B){for(r=0,s=B.length;s>r;r++){(b.query||"$score"!==B[r].field)&&v.push(B[r])}}if(b.query){for(A=!0,r=0,s=v.length;s>r;r++){if("$score"===v[r].field){A=!1;break}}A&&v.unshift({field:"$score",direction:"desc"})}else{for(r=0,s=v.length;s>r;r++){if("$score"===v[r].field){v.splice(r,1);break}}}for(y=[],r=0,s=v.length;s>r;r++){y.push("desc"===v[r].direction?-1:1)}return w=v.length,w?1===w?(u=v[0].field,x=y[0],function(d,e){return x*j(z(u,d),z(u,e))}):function(g,h){var C,D,E;for(C=0;w>C;C++){if(E=v[C].field,D=y[C]*j(z(E,g),z(E,h))){return D}}return 0}:null},i.prototype.prepareSearch=function(c,f){if("object"==typeof c){return c}f=k({},f);var h=f.fields,q=f.sort,r=f.sort_empty;return h&&!n(h)&&(f.fields=[h]),q&&!n(q)&&(f.sort=[q]),r&&!n(r)&&(f.sort_empty=[r]),{options:f,query:String(c||"").toLowerCase(),tokens:this.tokenize(c),total:0,items:[]}},i.prototype.search=function(h,q){var r,s,t,u,v=this;return s=this.prepareSearch(h,q),q=s.options,h=s.query,u=q.score||v.getScoreFunction(s),h.length?v.iterator(v.items,function(b,c){r=u(b),(q.filter===!1||r>0)&&s.items.push({score:r,id:c})}):v.iterator(v.items,function(c,d){s.items.push({score:1,id:d})}),t=v.getSortFunction(s,q),t&&s.items.sort(t),s.total=s.items.length,"number"==typeof q.limit&&(s.items=s.items.slice(0,q.limit)),s};var j=function(c,d){return"number"==typeof c&&"number"==typeof d?c>d?1:d>c?-1:0:(c=p(String(c||"")),d=p(String(d||"")),c>d?1:d>c?-1:0)},k=function(f){var g,h,q,r;for(g=1,h=arguments.length;h>g;g++){if(r=arguments[g]){for(q in r){r.hasOwnProperty(q)&&(f[q]=r[q])}}}return f},l=function(b){return(b+"").replace(/^\s+|\s+$|/g,"")},m=function(b){return(b+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},n=Array.isArray||$&&$.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)},o={a:"[aÀÁÂÃÄÅàáâãäåĀāąĄ]",c:"[cÇçćĆčČ]",d:"[dđĐďĎ]",e:"[eÈÉÊËèéêëěĚĒēęĘ]",i:"[iÌÍÎÏìíîïĪī]",l:"[lłŁ]",n:"[nÑñňŇńŃ]",o:"[oÒÓÔÕÕÖØòóôõöøŌō]",r:"[rřŘ]",s:"[sŠšśŚ]",t:"[tťŤ]",u:"[uÙÚÛÜùúûüůŮŪū]",y:"[yŸÿýÝ]",z:"[zŽžżŻźŹ]"},p=function(){var g,q,r,s,t="",u={};for(r in o){if(o.hasOwnProperty(r)){for(s=o[r].substring(2,o[r].length-1),t+=s,g=0,q=s.length;q>g;g++){u[s.charAt(g)]=r}}}var v=new RegExp("["+t+"]","g");return function(b){return b.replace(v,function(c){return u[c]}).toLowerCase()}}();return i}),function(c,d){"function"==typeof define&&define.amd?define("microplugin",d):"object"==typeof exports?module.exports=d():c.MicroPlugin=d()}(this,function(){var c={};c.mixin=function(b){b.plugins={},b.prototype.initializePlugins=function(h){var i,j,k,l=this,m=[];if(l.plugins={names:[],settings:{},requested:{},loaded:{}},d.isArray(h)){for(i=0,j=h.length;j>i;i++){"string"==typeof h[i]?m.push(h[i]):(l.plugins.settings[h[i].name]=h[i].options,m.push(h[i].name))}}else{if(h){for(k in h){h.hasOwnProperty(k)&&(l.plugins.settings[k]=h[k],m.push(k))}}}for(;m.length;){l.require(m.shift())}},b.prototype.loadPlugin=function(a){var f=this,g=f.plugins,h=b.plugins[a];if(!b.plugins.hasOwnProperty(a)){throw new Error('Unable to find "'+a+'" plugin')}g.requested[a]=!0,g.loaded[a]=h.fn.apply(f,[f.plugins.settings[a]||{}]),g.names.push(a)},b.prototype.require=function(e){var f=this,g=f.plugins;if(!f.plugins.loaded.hasOwnProperty(e)){if(g.requested[e]){throw new Error('Plugin has circular dependency ("'+e+'")')}f.loadPlugin(e)}return g.loaded[e]},b.define=function(a,e){b.plugins[a]={name:a,fn:e}}};var d={isArray:Array.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)}};return c}),function(c,d){"function"==typeof define&&define.amd?define("selectize",["jquery","sifter","microplugin"],d):"object"==typeof exports?module.exports=d(require("jquery"),require("sifter"),require("microplugin")):c.Selectize=d(c.jQuery,c.Sifter,c.MicroPlugin)}(this,function(M,O,Q){var S=function(e,f){if("string"!=typeof f||f.length){var g="string"==typeof f?new RegExp(f,"i"):f,h=function(c){var d=0;if(3===c.nodeType){var k=c.data.search(g);if(k>=0&&c.data.length>0){var l=c.data.match(g),m=document.createElement("span");m.className="highlight";var n=c.splitText(k),o=(n.splitText(l[0].length),n.cloneNode(!0));m.appendChild(o),n.parentNode.replaceChild(m,n),d=1}}else{if(1===c.nodeType&&c.childNodes&&!/(script|style)/i.test(c.tagName)){for(var p=0;p<c.childNodes.length;++p){p+=h(c.childNodes[p])}}}return d};return e.each(function(){h(this)})}},U=function(){};U.prototype={on:function(c,d){this._events=this._events||{},this._events[c]=this._events[c]||[],this._events[c].push(d)},off:function(d,e){var f=arguments.length;return 0===f?delete this._events:1===f?delete this._events[d]:(this._events=this._events||{},void (d in this._events!=!1&&this._events[d].splice(this._events[d].indexOf(e),1)))},trigger:function(c){if(this._events=this._events||{},c in this._events!=!1){for(var d=0;d<this._events[c].length;d++){this._events[c][d].apply(this,Array.prototype.slice.call(arguments,1))}}}},U.mixin=function(d){for(var e=["on","off","trigger"],f=0;f<e.length;f++){d.prototype[e[f]]=U.prototype[e[f]]}};var W=/Mac/.test(navigator.userAgent),Y=65,aa=13,ac=27,ae=37,ag=38,ai=80,ak=39,al=40,am=78,an=8,ao=46,ap=16,aq=W?91:17,ar=W?18:17,at=9,au=1,av=2,aw=!/android/i.test(window.navigator.userAgent)&&!!document.createElement("form").validity,ax=function(b){return"undefined"!=typeof b},ay=function(b){return"undefined"==typeof b||null===b?null:"boolean"==typeof b?b?"1":"0":b+""},N=function(b){return(b+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},P=function(b){return(b+"").replace(/\$/g,"$$$$")},R={};R.before=function(e,f,g){var h=e[f];e[f]=function(){return g.apply(e,arguments),h.apply(e,arguments)}},R.after=function(e,f,g){var h=e[f];e[f]=function(){var a=h.apply(e,arguments);return g.apply(e,arguments),a}};var T=function(c){var d=!1;return function(){d||(d=!0,c.apply(this,arguments))}},V=function(d,e){var f;return function(){var a=this,b=arguments;window.clearTimeout(f),f=window.setTimeout(function(){d.apply(a,b)},e)}},X=function(g,h,i){var j,k=g.trigger,l={};g.trigger=function(){var a=arguments[0];return -1===h.indexOf(a)?k.apply(g,arguments):void (l[a]=arguments)},i.apply(g,[]),g.trigger=k;for(j in l){l.hasOwnProperty(j)&&k.apply(g,l[j])}},Z=function(e,f,g,h){e.on(f,g,function(a){for(var d=a.target;d&&d.parentNode!==e[0];){d=d.parentNode}return a.currentTarget=d,h.apply(this,[a])})},ab=function(e){var f={};if("selectionStart" in e){f.start=e.selectionStart,f.length=e.selectionEnd-f.start}else{if(document.selection){e.focus();var g=document.selection.createRange(),h=document.selection.createRange().text.length;g.moveStart("character",-e.value.length),f.start=g.text.length-h,f.length=h}}return f},ad=function(g,h,i){var j,k,l={};if(i){for(j=0,k=i.length;k>j;j++){l[i[j]]=g.css(i[j])}}else{l=g.css()}h.css(l)},af=function(a,f){if(!a){return 0}var g=M("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(a).appendTo("body");ad(f,g,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var h=g.width();return g.remove(),h},ah=function(d){var e=null,f=function(a,b){var m,n,o,p,q,r,s,t;a=a||window.event||{},b=b||{},a.metaKey||a.altKey||(b.force||d.data("grow")!==!1)&&(m=d.val(),a.type&&"keydown"===a.type.toLowerCase()&&(n=a.keyCode,o=n>=97&&122>=n||n>=65&&90>=n||n>=48&&57>=n||32===n,n===ao||n===an?(t=ab(d[0]),t.length?m=m.substring(0,t.start)+m.substring(t.start+t.length):n===an&&t.start?m=m.substring(0,t.start-1)+m.substring(t.start+1):n===ao&&"undefined"!=typeof t.start&&(m=m.substring(0,t.start)+m.substring(t.start+1))):o&&(r=a.shiftKey,s=String.fromCharCode(a.keyCode),s=r?s.toUpperCase():s.toLowerCase(),m+=s)),p=d.attr("placeholder"),!m&&p&&(m=p),q=af(m,d)+4,q!==e&&(e=q,d.width(q),d.triggerHandler("resize")))};d.on("keydown keyup update blur",f),f()},aj=function(a,b){var k,l,m,n,o=this;n=a[0],n.selectize=o;var p=window.getComputedStyle&&window.getComputedStyle(n,null);if(m=p?p.getPropertyValue("direction"):n.currentStyle&&n.currentStyle.direction,m=m||a.parents("[dir]:first").attr("dir")||"",M.extend(o,{order:0,settings:b,$input:a,tabIndex:a.attr("tabindex")||"",tagType:"select"===n.tagName.toLowerCase()?au:av,rtl:/rtl/i.test(m),eventNS:".selectize"+ ++aj.count,highlightedValue:null,isOpen:!1,isDisabled:!1,isRequired:a.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreBlur:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:null===b.loadThrottle?o.onSearchChange:V(o.onSearchChange,b.loadThrottle)}),o.sifter=new O(this.options,{diacritics:b.diacritics}),o.settings.options){for(k=0,l=o.settings.options.length;l>k;k++){o.registerOption(o.settings.options[k])}delete o.settings.options}if(o.settings.optgroups){for(k=0,l=o.settings.optgroups.length;l>k;k++){o.registerOptionGroup(o.settings.optgroups[k])}delete o.settings.optgroups}o.settings.mode=o.settings.mode||(1===o.settings.maxItems?"single":"multi"),"boolean"!=typeof o.settings.hideSelected&&(o.settings.hideSelected="multi"===o.settings.mode),o.initializePlugins(o.settings.plugins),o.setupCallbacks(),o.setupTemplates(),o.setup()};return U.mixin(aj),Q.mixin(aj),M.extend(aj.prototype,{setup:function(){var a,f,r,s,t,v,w,x,y,z=this,A=z.settings,B=z.eventNS,C=M(window),D=M(document),E=z.$input;if(w=z.settings.mode,x=E.attr("class")||"",a=M("<div>").addClass(A.wrapperClass).addClass(x).addClass(w),f=M("<div>").addClass(A.inputClass).addClass("items").appendTo(a),r=M('<input type="text" autocomplete="off" />').appendTo(f).attr("tabindex",E.is(":disabled")?"-1":z.tabIndex),v=M(A.dropdownParent||a),s=M("<div>").addClass(A.dropdownClass).addClass(w).hide().appendTo(v),t=M("<div>").addClass(A.dropdownContentClass).appendTo(s),z.settings.copyClassesToDropdown&&s.addClass(x),a.css({width:E[0].style.width}),z.plugins.names.length&&(y="plugin-"+z.plugins.names.join(" plugin-"),a.addClass(y),s.addClass(y)),(null===A.maxItems||A.maxItems>1)&&z.tagType===au&&E.attr("multiple","multiple"),z.settings.placeholder&&r.attr("placeholder",A.placeholder),!z.settings.splitOn&&z.settings.delimiter){var F=z.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");z.settings.splitOn=new RegExp("\\s*"+F+"+\\s*")}E.attr("autocorrect")&&r.attr("autocorrect",E.attr("autocorrect")),E.attr("autocapitalize")&&r.attr("autocapitalize",E.attr("autocapitalize")),z.$wrapper=a,z.$control=f,z.$control_input=r,z.$dropdown=s,z.$dropdown_content=t,s.on("mouseenter","[data-selectable]",function(){return z.onOptionHover.apply(z,arguments)}),s.on("mousedown click","[data-selectable]",function(){return z.onOptionSelect.apply(z,arguments)}),Z(f,"mousedown","*:not(input)",function(){return z.onItemSelect.apply(z,arguments)}),ah(r),f.on({mousedown:function(){return z.onMouseDown.apply(z,arguments)},click:function(){return z.onClick.apply(z,arguments)}}),r.on({mousedown:function(b){b.stopPropagation()},keydown:function(){return z.onKeyDown.apply(z,arguments)},keyup:function(){return z.onKeyUp.apply(z,arguments)},keypress:function(){return z.onKeyPress.apply(z,arguments)},resize:function(){z.positionDropdown.apply(z,[])},blur:function(){return z.onBlur.apply(z,arguments)},focus:function(){return z.ignoreBlur=!1,z.onFocus.apply(z,arguments)},paste:function(){return z.onPaste.apply(z,arguments)}}),D.on("keydown"+B,function(b){z.isCmdDown=b[W?"metaKey":"ctrlKey"],z.isCtrlDown=b[W?"altKey":"ctrlKey"],z.isShiftDown=b.shiftKey}),D.on("keyup"+B,function(b){b.keyCode===ar&&(z.isCtrlDown=!1),b.keyCode===ap&&(z.isShiftDown=!1),b.keyCode===aq&&(z.isCmdDown=!1)}),D.on("mousedown"+B,function(b){if(z.isFocused){if(b.target===z.$dropdown[0]||b.target.parentNode===z.$dropdown[0]){return !1}z.$control.has(b.target).length||b.target===z.$control[0]||z.blur(b.target)}}),C.on(["scroll"+B,"resize"+B].join(" "),function(){z.isOpen&&z.positionDropdown.apply(z,arguments)}),C.on("mousemove"+B,function(){z.ignoreHover=!1}),this.revertSettings={$children:E.children().detach(),tabindex:E.attr("tabindex")},E.attr("tabindex",-1).hide().after(z.$wrapper),M.isArray(A.items)&&(z.setValue(A.items),delete A.items),aw&&E.on("invalid"+B,function(b){b.preventDefault(),z.isInvalid=!0,z.refreshState()}),z.updateOriginalInput(),z.refreshItems(),z.refreshState(),z.updatePlaceholder(),z.isSetup=!0,E.is(":disabled")&&z.disable(),z.on("change",this.onChange),E.data("selectize",z),E.addClass("selectized"),z.trigger("initialize"),A.preload===!0&&z.onSearchChange("")},setupTemplates:function(){var a=this,f=a.settings.labelField,g=a.settings.optgroupLabelField,h={optgroup:function(b){return'<div class="optgroup">'+b.html+"</div>"},optgroup_header:function(c,d){return'<div class="optgroup-header">'+d(c[g])+"</div>"},option:function(c,d){return'<div class="option">'+d(c[f])+"</div>"},item:function(c,d){return'<div class="item">'+d(c[f])+"</div>"},option_create:function(c,d){return'<div class="create">Add <strong>'+d(c.input)+"</strong>&hellip;</div>"}};a.settings.render=M.extend({},h,a.settings.render)},setupCallbacks:function(){var d,e,f={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(d in f){f.hasOwnProperty(d)&&(e=this.settings[f[d]],e&&this.on(d,e))}},onClick:function(c){var d=this;d.isFocused||(d.focus(),c.preventDefault())},onMouseDown:function(a){var e=this,f=a.isDefaultPrevented();M(a.target);if(e.isFocused){if(a.target!==e.$control_input[0]){return"single"===e.settings.mode?e.isOpen?e.close():e.open():f||e.setActiveItem(null),!1}}else{f||window.setTimeout(function(){e.focus()},0)}},onChange:function(){this.$input.trigger("change")},onPaste:function(a){var d=this;d.isFull()||d.isInputHidden||d.isLocked?a.preventDefault():d.settings.splitOn&&setTimeout(function(){for(var c=M.trim(d.$control_input.val()||"").split(d.settings.splitOn),f=0,g=c.length;g>f;f++){d.createItem(c[f])}},0)},onKeyPress:function(c){if(this.isLocked){return c&&c.preventDefault()}var d=String.fromCharCode(c.keyCode||c.which);return this.settings.create&&"multi"===this.settings.mode&&d===this.settings.delimiter?(this.createItem(),c.preventDefault(),!1):void 0},onKeyDown:function(e){var f=(e.target===this.$control_input[0],this);if(f.isLocked){return void (e.keyCode!==at&&e.preventDefault())}switch(e.keyCode){case Y:if(f.isCmdDown){return void f.selectAll()}break;case ac:return void (f.isOpen&&(e.preventDefault(),e.stopPropagation(),f.close()));case am:if(!e.ctrlKey||e.altKey){break}case al:if(!f.isOpen&&f.hasOptions){f.open()}else{if(f.$activeOption){f.ignoreHover=!0;var g=f.getAdjacentOption(f.$activeOption,1);g.length&&f.setActiveOption(g,!0,!0)}}return void e.preventDefault();case ai:if(!e.ctrlKey||e.altKey){break}case ag:if(f.$activeOption){f.ignoreHover=!0;var h=f.getAdjacentOption(f.$activeOption,-1);h.length&&f.setActiveOption(h,!0,!0)}return void e.preventDefault();case aa:return void (f.isOpen&&f.$activeOption&&(f.onOptionSelect({currentTarget:f.$activeOption}),e.preventDefault()));case ae:return void f.advanceSelection(-1,e);case ak:return void f.advanceSelection(1,e);case at:return f.settings.selectOnTab&&f.isOpen&&f.$activeOption&&(f.onOptionSelect({currentTarget:f.$activeOption}),f.isFull()||e.preventDefault()),void (f.settings.create&&f.createItem()&&e.preventDefault());case an:case ao:return void f.deleteSelection(e)}return !f.isFull()&&!f.isInputHidden||(W?e.metaKey:e.ctrlKey)?void 0:void e.preventDefault()},onKeyUp:function(d){var e=this;if(e.isLocked){return d&&d.preventDefault()}var f=e.$control_input.val()||"";e.lastValue!==f&&(e.lastValue=f,e.onSearchChange(f),e.refreshOptions(),e.trigger("type",f))},onSearchChange:function(d){var e=this,f=e.settings.load;f&&(e.loadedSearches.hasOwnProperty(d)||(e.loadedSearches[d]=!0,e.load(function(a){f.apply(e,[d,a])})))},onFocus:function(d){var e=this,f=e.isFocused;return e.isDisabled?(e.blur(),d&&d.preventDefault(),!1):void (e.ignoreFocus||(e.isFocused=!0,"focus"===e.settings.preload&&e.onSearchChange(""),f||e.trigger("focus"),e.$activeItems.length||(e.showInput(),e.setActiveItem(null),e.refreshOptions(!!e.settings.openOnFocus)),e.refreshState()))},onBlur:function(e,f){var g=this;if(g.isFocused&&(g.isFocused=!1,!g.ignoreFocus)){if(!g.ignoreBlur&&document.activeElement===g.$dropdown_content[0]){return g.ignoreBlur=!0,void g.onFocus(e)}var h=function(){g.close(),g.setTextboxValue(""),g.setActiveItem(null),g.setActiveOption(null),g.setCaret(g.items.length),g.refreshState(),(f||document.body).focus(),g.ignoreFocus=!1,g.trigger("blur")};g.ignoreFocus=!0,g.settings.create&&g.settings.createOnBlur?g.createItem(null,!1,h):h()}},onOptionHover:function(b){this.ignoreHover||this.setActiveOption(b.currentTarget,!1)},onOptionSelect:function(a){var f,g,h=this;a.preventDefault&&(a.preventDefault(),a.stopPropagation()),g=M(a.currentTarget),g.hasClass("create")?h.createItem(null,function(){h.settings.closeAfterSelect&&h.close()}):(f=g.attr("data-value"),"undefined"!=typeof f&&(h.lastQuery=null,h.setTextboxValue(""),h.addItem(f),h.settings.closeAfterSelect?h.close():!h.settings.hideSelected&&a.type&&/mouse/.test(a.type)&&h.setActiveOption(h.getOption(f))))},onItemSelect:function(c){var d=this;d.isLocked||"multi"===d.settings.mode&&(c.preventDefault(),d.setActiveItem(c.currentTarget,c))},load:function(d){var e=this,f=e.$wrapper.addClass(e.settings.loadingClass);e.loading++,d.apply(e,[function(b){e.loading=Math.max(e.loading-1,0),b&&b.length&&(e.addOption(b),e.refreshOptions(e.isFocused&&!e.isInputHidden)),e.loading||f.removeClass(e.settings.loadingClass),e.trigger("load",b)}])},setTextboxValue:function(d){var e=this.$control_input,f=e.val()!==d;f&&(e.val(d).triggerHandler("update"),this.lastValue=d)},getValue:function(){return this.tagType===au&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(d,e){var f=e?[]:["change"];X(this,f,function(){this.clear(e),this.addItems(d,e)})},setActiveItem:function(a,m){var n,o,p,q,r,s,t,u,v=this;if("single"!==v.settings.mode){if(a=M(a),!a.length){return M(v.$activeItems).removeClass("active"),v.$activeItems=[],void (v.isFocused&&v.showInput())}if(n=m&&m.type.toLowerCase(),"mousedown"===n&&v.isShiftDown&&v.$activeItems.length){for(u=v.$control.children(".active:last"),q=Array.prototype.indexOf.apply(v.$control[0].childNodes,[u[0]]),r=Array.prototype.indexOf.apply(v.$control[0].childNodes,[a[0]]),q>r&&(t=q,q=r,r=t),o=q;r>=o;o++){s=v.$control[0].childNodes[o],-1===v.$activeItems.indexOf(s)&&(M(s).addClass("active"),v.$activeItems.push(s))}m.preventDefault()}else{"mousedown"===n&&v.isCtrlDown||"keydown"===n&&this.isShiftDown?a.hasClass("active")?(p=v.$activeItems.indexOf(a[0]),v.$activeItems.splice(p,1),a.removeClass("active")):v.$activeItems.push(a.addClass("active")[0]):(M(v.$activeItems).removeClass("active"),v.$activeItems=[a.addClass("active")[0]])}v.hideInput(),this.isFocused||v.focus()}},setActiveOption:function(a,k,l){var m,n,o,p,q,r=this;r.$activeOption&&r.$activeOption.removeClass("active"),r.$activeOption=null,a=M(a),a.length&&(r.$activeOption=a.addClass("active"),(k||!ax(k))&&(m=r.$dropdown_content.height(),n=r.$activeOption.outerHeight(!0),k=r.$dropdown_content.scrollTop()||0,o=r.$activeOption.offset().top-r.$dropdown_content.offset().top+k,p=o,q=o-m+n,o+n>m+k?r.$dropdown_content.stop().animate({scrollTop:q},l?r.settings.scrollDuration:0):k>o&&r.$dropdown_content.stop().animate({scrollTop:p},l?r.settings.scrollDuration:0)))},selectAll:function(){var b=this;"single"!==b.settings.mode&&(b.$activeItems=Array.prototype.slice.apply(b.$control.children(":not(input)").addClass("active")),b.$activeItems.length&&(b.hideInput(),b.close()),b.focus())},hideInput:function(){var b=this;b.setTextboxValue(""),b.$control_input.css({opacity:0,position:"absolute",left:b.rtl?10000:-10000}),b.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var b=this;b.isDisabled||(b.ignoreFocus=!0,b.$control_input[0].focus(),window.setTimeout(function(){b.ignoreFocus=!1,b.onFocus()},0))},blur:function(b){this.$control_input[0].blur(),this.onBlur(null,b)},getScoreFunction:function(b){return this.sifter.getScoreFunction(b,this.getSearchOptions())},getSearchOptions:function(){var c=this.settings,d=c.sortField;return"string"==typeof d&&(d=[{field:d}]),{fields:c.searchField,conjunction:c.searchConjunction,sort:d}},search:function(a){var i,j,k,l=this,m=l.settings,n=this.getSearchOptions();if(m.score&&(k=l.settings.score.apply(this,[a]),"function"!=typeof k)){throw new Error('Selectize "score" setting must be a function that returns a function')}if(a!==l.lastQuery?(l.lastQuery=a,j=l.sifter.search(a,M.extend(n,{score:k})),l.currentResults=j):j=M.extend(!0,{},l.currentResults),m.hideSelected){for(i=j.items.length-1;i>=0;i--){-1!==l.items.indexOf(ay(j.items[i].id))&&j.items.splice(i,1)}}return j},refreshOptions:function(a){var d,y,z,A,B,C,D,E,F,G,H,I,J,K,L,az;"undefined"==typeof a&&(a=!0);var aA=this,aB=M.trim(aA.$control_input.val()),aC=aA.search(aB),aD=aA.$dropdown_content,aE=aA.$activeOption&&ay(aA.$activeOption.attr("data-value"));for(A=aC.items.length,"number"==typeof aA.settings.maxOptions&&(A=Math.min(A,aA.settings.maxOptions)),B={},C=[],d=0;A>d;d++){for(D=aA.options[aC.items[d].id],E=aA.render("option",D),F=D[aA.settings.optgroupField]||"",G=M.isArray(F)?F:[F],y=0,z=G&&G.length;z>y;y++){F=G[y],aA.optgroups.hasOwnProperty(F)||(F=""),B.hasOwnProperty(F)||(B[F]=[],C.push(F)),B[F].push(E)}}for(this.settings.lockOptgroupOrder&&C.sort(function(e,f){var g=aA.optgroups[e].$order||0,h=aA.optgroups[f].$order||0;return g-h}),H=[],d=0,A=C.length;A>d;d++){F=C[d],aA.optgroups.hasOwnProperty(F)&&B[F].length?(I=aA.render("optgroup_header",aA.optgroups[F])||"",I+=B[F].join(""),H.push(aA.render("optgroup",M.extend({},aA.optgroups[F],{html:I})))):H.push(B[F].join(""))}if(aD.html(H.join("")),aA.settings.highlight&&aC.query.length&&aC.tokens.length){for(d=0,A=aC.tokens.length;A>d;d++){S(aD,aC.tokens[d].regex)}}if(!aA.settings.hideSelected){for(d=0,A=aA.items.length;A>d;d++){aA.getOption(aA.items[d]).addClass("selected")}}J=aA.canCreate(aB),J&&(aD.prepend(aA.render("option_create",{input:aB})),az=M(aD[0].childNodes[0])),aA.hasOptions=aC.items.length>0||J,aA.hasOptions?(aC.items.length>0?(L=aE&&aA.getOption(aE),L&&L.length?K=L:"single"===aA.settings.mode&&aA.items.length&&(K=aA.getOption(aA.items[0])),K&&K.length||(K=az&&!aA.settings.addPrecedence?aA.getAdjacentOption(az,1):aD.find("[data-selectable]:first"))):K=az,aA.setActiveOption(K),a&&!aA.isOpen&&aA.open()):(aA.setActiveOption(null),a&&aA.isOpen&&aA.close())},addOption:function(a){var g,h,i,j=this;if(M.isArray(a)){for(g=0,h=a.length;h>g;g++){j.addOption(a[g])}}else{(i=j.registerOption(a))&&(j.userOptions[i]=!0,j.lastQuery=null,j.trigger("option_add",i,a))}},registerOption:function(c){var d=ay(c[this.settings.valueField]);return !d||this.options.hasOwnProperty(d)?!1:(c.$order=c.$order||++this.order,this.options[d]=c,d)},registerOptionGroup:function(c){var d=ay(c[this.settings.optgroupValueField]);return d?(c.$order=c.$order||++this.order,this.optgroups[d]=c,d):!1},addOptionGroup:function(c,d){d[this.settings.optgroupValueField]=c,(c=this.registerOptionGroup(d))&&this.trigger("optgroup_add",c,d)},removeOptionGroup:function(b){this.optgroups.hasOwnProperty(b)&&(delete this.optgroups[b],this.renderCache={},this.trigger("optgroup_remove",b))},clearOptionGroups:function(){this.optgroups={},this.renderCache={},this.trigger("optgroup_clear")},updateOption:function(a,l){var m,n,o,p,q,r,s,t=this;if(a=ay(a),o=ay(l[t.settings.valueField]),null!==a&&t.options.hasOwnProperty(a)){if("string"!=typeof o){throw new Error("Value must be set in option data")}s=t.options[a].$order,o!==a&&(delete t.options[a],p=t.items.indexOf(a),-1!==p&&t.items.splice(p,1,o)),l.$order=l.$order||s,t.options[o]=l,q=t.renderCache.item,r=t.renderCache.option,q&&(delete q[a],delete q[o]),r&&(delete r[a],delete r[o]),-1!==t.items.indexOf(o)&&(m=t.getItem(a),n=M(t.render("item",l)),m.hasClass("active")&&n.addClass("active"),m.replaceWith(n)),t.lastQuery=null,t.isOpen&&t.refreshOptions(!1)}},removeOption:function(f,g){var h=this;f=ay(f);var i=h.renderCache.item,j=h.renderCache.option;i&&delete i[f],j&&delete j[f],delete h.userOptions[f],delete h.options[f],h.lastQuery=null,h.trigger("option_remove",f),h.removeItem(f,g)},clearOptions:function(){var b=this;b.loadedSearches={},b.userOptions={},b.renderCache={},b.options=b.sifter.items={},b.lastQuery=null,b.trigger("option_clear"),b.clear()},getOption:function(b){return this.getElementWithValue(b,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(a,f){var g=this.$dropdown.find("[data-selectable]"),h=g.index(a)+f;return h>=0&&h<g.length?g.eq(h):M()},getElementWithValue:function(a,f){if(a=ay(a),"undefined"!=typeof a&&null!==a){for(var g=0,h=f.length;h>g;g++){if(f[g].getAttribute("data-value")===a){return M(f[g])}}}return M()},getItem:function(b){return this.getElementWithValue(b,this.$control.children())},addItems:function(a,g){for(var h=M.isArray(a)?a:[a],i=0,j=h.length;j>i;i++){this.isPending=j-1>i,this.addItem(h[i],g)}},addItem:function(a,e){var f=e?[]:["change"];X(this,f,function(){var b,c,k,l,m,n=this,o=n.settings.mode;return a=ay(a),-1!==n.items.indexOf(a)?void ("single"===o&&n.close()):void (n.options.hasOwnProperty(a)&&("single"===o&&n.clear(e),"multi"===o&&n.isFull()||(b=M(n.render("item",n.options[a])),m=n.isFull(),n.items.splice(n.caretPos,0,a),n.insertAtCaret(b),(!n.isPending||!m&&n.isFull())&&n.refreshState(),n.isSetup&&(k=n.$dropdown_content.find("[data-selectable]"),n.isPending||(c=n.getOption(a),l=n.getAdjacentOption(c,1).attr("data-value"),n.refreshOptions(n.isFocused&&"single"!==o),l&&n.setActiveOption(n.getOption(l))),!k.length||n.isFull()?n.close():n.positionDropdown(),n.updatePlaceholder(),n.trigger("item_add",a,b),n.updateOriginalInput({silent:e})))))})},removeItem:function(g,h){var i,j,k,l=this;i="object"==typeof g?g:l.getItem(g),g=ay(i.attr("data-value")),j=l.items.indexOf(g),-1!==j&&(i.remove(),i.hasClass("active")&&(k=l.$activeItems.indexOf(i[0]),l.$activeItems.splice(k,1)),l.items.splice(j,1),l.lastQuery=null,!l.settings.persist&&l.userOptions.hasOwnProperty(g)&&l.removeOption(g,h),j<l.caretPos&&l.setCaret(l.caretPos-1),l.refreshState(),l.updatePlaceholder(),l.updateOriginalInput({silent:h}),l.positionDropdown(),l.trigger("item_remove",g,i))},createItem:function(a,j){var k=this,l=k.caretPos;a=a||M.trim(k.$control_input.val()||"");var m=arguments[arguments.length-1];if("function"!=typeof m&&(m=function(){}),"boolean"!=typeof j&&(j=!0),!k.canCreate(a)){return m(),!1}k.lock();var n="function"==typeof k.settings.create?this.settings.create:function(c){var d={};return d[k.settings.labelField]=c,d[k.settings.valueField]=c,d},o=T(function(c){if(k.unlock(),!c||"object"!=typeof c){return m()}var d=ay(c[k.settings.valueField]);return"string"!=typeof d?m():(k.setTextboxValue(""),k.addOption(c),k.setCaret(l),k.addItem(d),k.refreshOptions(j&&"single"!==k.settings.mode),void m(c))}),p=n.apply(this,[a,o]);return"undefined"!=typeof p&&o(p),!0},refreshItems:function(){this.lastQuery=null,this.isSetup&&this.addItem(this.items),this.refreshState(),this.updateOriginalInput()},refreshState:function(){var c,d=this;d.isRequired&&(d.items.length&&(d.isInvalid=!1),d.$control_input.prop("required",c)),d.refreshClasses()},refreshClasses:function(){var a=this,e=a.isFull(),f=a.isLocked;a.$wrapper.toggleClass("rtl",a.rtl),a.$control.toggleClass("focus",a.isFocused).toggleClass("disabled",a.isDisabled).toggleClass("required",a.isRequired).toggleClass("invalid",a.isInvalid).toggleClass("locked",f).toggleClass("full",e).toggleClass("not-full",!e).toggleClass("input-active",a.isFocused&&!a.isInputHidden).toggleClass("dropdown-active",a.isOpen).toggleClass("has-options",!M.isEmptyObject(a.options)).toggleClass("has-items",a.items.length>0),a.$control_input.data("grow",!e&&!f)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(g){var h,i,j,k,l=this;if(g=g||{},l.tagType===au){for(j=[],h=0,i=l.items.length;i>h;h++){k=l.options[l.items[h]][l.settings.labelField]||"",j.push('<option value="'+N(l.items[h])+'" selected="selected">'+N(k)+"</option>")}j.length||this.$input.attr("multiple")||j.push('<option value="" selected="selected"></option>'),l.$input.html(j.join(""))}else{l.$input.val(l.getValue()),l.$input.attr("value",l.$input.val())}l.isSetup&&(g.silent||l.trigger("change",l.$input.val()))},updatePlaceholder:function(){if(this.settings.placeholder){var b=this.$control_input;this.items.length?b.removeAttr("placeholder"):b.attr("placeholder",this.settings.placeholder),b.triggerHandler("update",{force:!0})}},open:function(){var b=this;b.isLocked||b.isOpen||"multi"===b.settings.mode&&b.isFull()||(b.focus(),b.isOpen=!0,b.refreshState(),b.$dropdown.css({visibility:"hidden",display:"block"}),b.positionDropdown(),b.$dropdown.css({visibility:"visible"}),b.trigger("dropdown_open",b.$dropdown))},close:function(){var c=this,d=c.isOpen;"single"===c.settings.mode&&c.items.length&&c.hideInput(),c.isOpen=!1,c.$dropdown.hide(),c.setActiveOption(null),c.refreshState(),d&&c.trigger("dropdown_close",c.$dropdown)},positionDropdown:function(){var c=this.$control,d="body"===this.settings.dropdownParent?c.offset():c.position();d.top+=c.outerHeight(!0),this.$dropdown.css({width:c.outerWidth(),top:d.top,left:d.left})},clear:function(c){var d=this;d.items.length&&(d.$control.children(":not(input)").remove(),d.items=[],d.lastQuery=null,d.setCaret(0),d.setActiveItem(null),d.updatePlaceholder(),d.updateOriginalInput({silent:c}),d.refreshState(),d.showInput(),d.trigger("clear"))},insertAtCaret:function(a){var d=Math.min(this.caretPos,this.items.length);0===d?this.$control.prepend(a):M(this.$control[0].childNodes[d]).before(a),this.setCaret(d+1)},deleteSelection:function(a){var m,n,o,p,q,r,s,t,u,v=this;if(o=a&&a.keyCode===an?-1:1,p=ab(v.$control_input[0]),v.$activeOption&&!v.settings.hideSelected&&(s=v.getAdjacentOption(v.$activeOption,-1).attr("data-value")),q=[],v.$activeItems.length){for(u=v.$control.children(".active:"+(o>0?"last":"first")),r=v.$control.children(":not(input)").index(u),o>0&&r++,m=0,n=v.$activeItems.length;n>m;m++){q.push(M(v.$activeItems[m]).attr("data-value"))}a&&(a.preventDefault(),a.stopPropagation())}else{(v.isFocused||"single"===v.settings.mode)&&v.items.length&&(0>o&&0===p.start&&0===p.length?q.push(v.items[v.caretPos-1]):o>0&&p.start===v.$control_input.val().length&&q.push(v.items[v.caretPos]))}if(!q.length||"function"==typeof v.settings.onDelete&&v.settings.onDelete.apply(v,[q])===!1){return !1}for("undefined"!=typeof r&&v.setCaret(r);q.length;){v.removeItem(q.pop())}return v.showInput(),v.positionDropdown(),v.refreshOptions(!0),s&&(t=v.getOption(s),t.length&&v.setActiveOption(t)),!0},advanceSelection:function(j,k){var l,m,n,o,p,q,r=this;0!==j&&(r.rtl&&(j*=-1),l=j>0?"last":"first",m=ab(r.$control_input[0]),r.isFocused&&!r.isInputHidden?(o=r.$control_input.val().length,p=0>j?0===m.start&&0===m.length:m.start===o,p&&!o&&r.advanceCaret(j,k)):(q=r.$control.children(".active:"+l),q.length&&(n=r.$control.children(":not(input)").index(q),r.setActiveItem(null),r.setCaret(j>0?n+1:n))))},advanceCaret:function(f,g){var h,i,j=this;0!==f&&(h=f>0?"next":"prev",j.isShiftDown?(i=j.$control_input[h](),i.length&&(j.hideInput(),j.setActiveItem(i),g&&g.preventDefault())):j.setCaret(j.caretPos+f))},setCaret:function(a){var h=this;if(a="single"===h.settings.mode?h.items.length:Math.max(0,Math.min(h.items.length,a)),!h.isPending){var i,j,k,l;for(k=h.$control.children(":not(input)"),i=0,j=k.length;j>i;i++){l=M(k[i]).detach(),a>i?h.$control_input.before(l):h.$control.append(l)}}h.caretPos=a},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){var b=this;b.$input.prop("disabled",!0),b.$control_input.prop("disabled",!0).prop("tabindex",-1),b.isDisabled=!0,b.lock()},enable:function(){var b=this;b.$input.prop("disabled",!1),b.$control_input.prop("disabled",!1).prop("tabindex",b.tabIndex),b.isDisabled=!1,b.unlock()},destroy:function(){var a=this,e=a.eventNS,f=a.revertSettings;a.trigger("destroy"),a.off(),a.$wrapper.remove(),a.$dropdown.remove(),a.$input.html("").append(f.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:f.tabindex}).show(),a.$control_input.removeData("grow"),a.$input.removeData("selectize"),M(window).off(e),M(document).off(e),M(document.body).off(e),delete a.$input[0].selectize},render:function(i,j){var k,l,m="",n=!1,o=this,p=/^[\t \r\n]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;return("option"===i||"item"===i)&&(k=ay(j[o.settings.valueField]),n=!!k),n&&(ax(o.renderCache[i])||(o.renderCache[i]={}),o.renderCache[i].hasOwnProperty(k))?o.renderCache[i][k]:(m=o.settings.render[i].apply(this,[j,N]),("option"===i||"option_create"===i)&&(m=m.replace(p,"<$1 data-selectable")),"optgroup"===i&&(l=j[o.settings.optgroupValueField]||"",m=m.replace(p,'<$1 data-group="'+P(N(l))+'"')),("option"===i||"item"===i)&&(m=m.replace(p,'<$1 data-value="'+P(N(k||""))+'"')),n&&(o.renderCache[i][k]=m),m)},clearCache:function(c){var d=this;"undefined"==typeof c?d.renderCache={}:delete d.renderCache[c]},canCreate:function(d){var e=this;if(!e.settings.create){return !1}var f=e.settings.createFilter;return !(!d.length||"function"==typeof f&&!f.apply(e,[d])||"string"==typeof f&&!new RegExp(f).test(d)||f instanceof RegExp&&!f.test(d))}}),aj.count=0,aj.defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:!1,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,maxOptions:1000,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!1,preload:!1,allowEmptyOption:!1,closeAfterSelect:!1,scrollDuration:60,loadThrottle:300,loadingClass:"loading",dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:!0,render:{}},M.fn.selectize=function(a){var m=M.fn.selectize.defaults,n=M.extend({},m,a),o=n.dataAttr,p=n.labelField,q=n.valueField,r=n.optgroupField,s=n.optgroupLabelField,t=n.optgroupValueField,u=function(d,e){var f,g,w,x,y=d.attr(o);if(y){for(e.options=JSON.parse(y),f=0,g=e.options.length;g>f;f++){e.items.push(e.options[f][q])}}else{var z=M.trim(d.val()||"");if(!n.allowEmptyOption&&!z.length){return}for(w=z.split(n.delimiter),f=0,g=w.length;g>f;f++){x={},x[p]=w[f],x[q]=w[f],e.options.push(x)}e.items=w}},v=function(d,e){var f,g,h,i,j=e.options,w={},x=function(c){var k=o&&c.attr(o);return"string"==typeof k&&k.length?JSON.parse(k):null},y=function(c,l){c=M(c);var A=ay(c.attr("value"));if(A||n.allowEmptyOption){if(w.hasOwnProperty(A)){if(l){var B=w[A][r];B?M.isArray(B)?B.push(l):w[A][r]=[B,l]:w[A][r]=l}}else{var C=x(c)||{};C[p]=C[p]||c.text(),C[q]=C[q]||A,C[r]=C[r]||l,w[A]=C,j.push(C),c.is(":selected")&&e.items.push(A)}}},z=function(c){var k,l,A,B,C;for(c=M(c),A=c.attr("label"),A&&(B=x(c)||{},B[s]=A,B[t]=A,e.optgroups.push(B)),C=M("option",c),k=0,l=C.length;l>k;k++){y(C[k],A)}};for(e.maxItems=d.attr("multiple")?null:1,i=d.children(),f=0,g=i.length;g>f;f++){h=i[f].tagName.toLowerCase(),"optgroup"===h?z(i[f]):"option"===h&&y(i[f])}};return this.each(function(){if(!this.selectize){var b,c=M(this),d=this.tagName.toLowerCase(),j=c.attr("placeholder")||c.attr("data-placeholder");j||n.allowEmptyOption||(j=c.children('option[value=""]').text());var k={placeholder:j,options:[],optgroups:[],items:[]};"select"===d?v(c,k):u(c,k),b=new aj(c,M.extend(!0,{},m,k,a))}})},M.fn.selectize.defaults=aj.defaults,M.fn.selectize.support={validity:aw},aj.define("drag_drop",function(){if(!M.fn.sortable){throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".')}if("multi"===this.settings.mode){var a=this;a.lock=function(){var b=a.lock;return function(){var d=a.$control.data("sortable");return d&&d.disable(),b.apply(a,arguments)}}(),a.unlock=function(){var b=a.unlock;return function(){var d=a.$control.data("sortable");return d&&d.enable(),b.apply(a,arguments)}}(),a.setup=function(){var b=a.setup;return function(){b.apply(this,arguments);var c=a.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:a.isLocked,start:function(d,e){e.placeholder.css("width",e.helper.css("width")),c.css({overflow:"visible"})},stop:function(){c.css({overflow:"hidden"});var d=a.$activeItems?a.$activeItems.slice():null,f=[];c.children("[data-value]").each(function(){f.push(M(this).attr("data-value"))}),a.setValue(f),a.setActiveItem(d)}})}}()}}),aj.define("dropdown_header",function(a){var d=this;a=M.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(b){return'<div class="'+b.headerClass+'"><div class="'+b.titleRowClass+'"><span class="'+b.labelClass+'">'+b.title+'</span><a href="javascript:void(0)" class="'+b.closeClass+'">&times;</a></div></div>'}},a),d.setup=function(){var b=d.setup;return function(){b.apply(d,arguments),d.$dropdown_header=M(a.html(a)),d.$dropdown.prepend(d.$dropdown_header)}}()}),aj.define("optgroup_columns",function(a){var f=this;a=M.extend({equalizeWidth:!0,equalizeHeight:!0},a),this.getAdjacentOption=function(i,j){var k=i.closest("[data-group]").find("[data-selectable]"),l=k.index(i)+j;return l>=0&&l<k.length?k.eq(l):M()},this.onKeyDown=function(){var b=f.onKeyDown;return function(c){var i,j,k,l;return !this.isOpen||c.keyCode!==ae&&c.keyCode!==ak?b.apply(this,arguments):(f.ignoreHover=!0,l=this.$activeOption.closest("[data-group]"),i=l.find("[data-selectable]").index(this.$activeOption),l=c.keyCode===ae?l.prev("[data-group]"):l.next("[data-group]"),k=l.find("[data-selectable]"),j=k.eq(Math.min(k.length-1,i)),void (j.length&&this.setActiveOption(j)))}}();var g=function(){var d,e=g.width,i=document;return"undefined"==typeof e&&(d=i.createElement("div"),d.innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>',d=d.firstChild,i.body.appendChild(d),e=g.width=d.offsetWidth-d.clientWidth,i.body.removeChild(d)),e},h=function(){var b,c,d,l,m,n,o;if(o=M("[data-group]",f.$dropdown_content),c=o.length,c&&f.$dropdown_content.width()){if(a.equalizeHeight){for(d=0,b=0;c>b;b++){d=Math.max(d,o.eq(b).height())}o.css({height:d})}a.equalizeWidth&&(n=f.$dropdown_content.innerWidth()-g(),l=Math.round(n/c),o.css({width:l}),c>1&&(m=n-l*(c-1),o.eq(c-1).css({width:m})))}};(a.equalizeHeight||a.equalizeWidth)&&(R.after(this,"positionDropdown",h),R.after(this,"refreshOptions",h))}),aj.define("remove_button",function(a){if("single"!==this.settings.mode){a=M.extend({label:"&times;",title:"Remove",className:"remove",append:!0},a);var f=this,g='<a href="javascript:void(0)" class="'+a.className+'" tabindex="-1" title="'+N(a.title)+'">'+a.label+"</a>",h=function(d,e){var i=d.search(/(<\/[^>]+>\s*)$/);return d.substring(0,i)+e+d.substring(i)};this.setup=function(){var b=f.setup;return function(){if(a.append){var c=f.settings.render.item;f.settings.render.item=function(){return h(c.apply(this,arguments),g)}}b.apply(this,arguments),this.$control.on("click","."+a.className,function(e){if(e.preventDefault(),!f.isLocked){var i=M(e.currentTarget).parent();f.setActiveItem(i),f.deleteSelection()&&f.setCaret(f.items.length)}})}}()}}),aj.define("restore_on_backspace",function(c){var d=this;c.text=c.text||function(b){return b[this.settings.labelField]},this.onKeyDown=function(){var a=d.onKeyDown;return function(f){var g,h;return f.keyCode===an&&""===this.$control_input.val()&&!this.$activeItems.length&&(g=this.caretPos-1,g>=0&&g<this.items.length)?(h=this.options[this.items[g]],this.deleteSelection(f)&&(this.setTextboxValue(c.text.apply(this,[h])),this.refreshOptions(!0)),void f.preventDefault()):a.apply(this,arguments)}}()}),aj});